"""
项目说明文档 - 通讯录存储与检索系统
"""

# 通讯录管理系统 - 完整项目说明

## 项目概述

本项目实现了一个功能完整的通讯录存储与检索系统，采用双向链表 + 散列表 + Trie树索引的混合数据结构设计，支持高效的联系人管理和查询。

## 核心特性

### 1. 数据结构设计
- **双向链表**：维护联系人的插入顺序，支持快速遍历，O(1)尾插入
- **散列表**：支持O(1)平均复杂度的名字和电话查询
- **Trie树**（可选）：支持高效的前缀检索，O(m+k)复杂度，其中m为前缀长度，k为结果数

### 2. 功能列表
| 命令 | 功能 | 复杂度 |
|------|------|--------|
| ADD | 添加联系人 | O(1) |
| DEL | 删除联系人（支持按名字或电话） | O(n)* |
| FIND_NAME | 按名字前缀查询 | O(m+k)** |
| FIND_PHONE | 按电话前缀查询 | O(m+k)** |
| LIST | 列出所有联系人 | O(n) |
| STAT | 显示统计信息 | O(1) |
| SAVE | 保存到JSON文件 | O(n) |
| HELP | 显示帮助信息 | - |
| EXIT | 退出系统 | - |

*需要在链表中查找节点，可优化为O(1)如果使用额外哈希表
**使用Trie树时的复杂度；无索引时为O(n)

### 3. 联系人属性
- **姓名** (必填)：支持重名
- **电话号码** (必填)：唯一性约束，两个联系人不能使用同一电话号码
- **备注** (可选)：存储额外信息

### 4. 持久化机制
- **存储格式**：JSON（易于读写和调试）
- **自动加载**：系统启动时自动加载contacts.json中的数据
- **手动保存**：SAVE命令触发数据持久化
- **容错性**：支持恢复到上次保存状态

## 文件结构

```
├── contact.py              # 核心模块：数据结构和系统实现
├── cli.py                  # 命令行交互界面
├── test_units.py          # 单元测试
├── test_performance.py    # 性能测试和基准对比
├── README.md              # 项目说明（本文件）
└── contacts.json          # 数据文件（运行时生成）
```

## 使用说明

### 安装与运行

#### 1. 启动交互式界面
```bash
python cli.py
```

#### 2. 运行单元测试
```bash
python test_units.py
```

#### 3. 执行性能测试
```bash
python test_performance.py
```

### 命令示例

#### 添加联系人
```
>>> ADD 张三 13800000001 工作电话
✓ 成功：已添加联系人 张三 (13800000001)

>>> ADD 张四 13800000002
✓ 成功：已添加联系人 张四 (13800000002)
```

#### 查询联系人
```
>>> FIND_NAME 张
找到 2 个联系人：
┌─────────────────────────────────────────────────────┐
│ 序号 │     姓名     │      电话      │      备注      │
├─────────────────────────────────────────────────────┤
│  1  │    张三     │ 13800000001  │    工作电话     │
│  2  │    张四     │ 13800000002  │                 │
└─────────────────────────────────────────────────────┘

>>> FIND_PHONE 138
找到 2 个联系人：
[同上]
```

#### 删除联系人
```
>>> DEL 张三
✓ 成功：已删除 1 个联系人

>>> DEL 13800000002
✓ 成功：已删除 1 个联系人
```

#### 列出所有
```
>>> LIST
共 0 个联系人：
```

#### 保存数据
```
>>> SAVE
✓ 成功：数据已保存到 contacts.json
```

#### 显示统计
```
>>> STAT
╔════════════════════════════════════════╗
║         系统统计信息                   ║
╚════════════════════════════════════════╝
总联系人数：       5
唯一姓名数：       4
姓名索引启用：     是 (Trie树)
电话索引启用：     是 (Trie树)
```

## 性能分析

### 时间复杂度对比

#### 带Trie树索引
- 插入：O(m)，m为字符串长度
- 前缀查询：O(m + k)，k为结果数
- 精确查询（电话）：O(1) - 散列表

#### 无索引（线性扫描）
- 前缀查询：O(n) - 需遍历所有记录
- 查询速度随数据规模线性增长

### 性能提升倍数

根据性能测试结果（见test_performance.py）：

| 数据规模 | 名字查询加速比 | 电话查询加速比 |
|---------|--------------|--------------|
| 1,000 | ~10x | ~8x |
| 5,000 | ~30x | ~25x |
| 10,000 | ~50x | ~45x |

**注**：具体加速比取决于查询前缀的选择性和数据分布

### 空间复杂度

- **双向链表**：O(n)
- **散列表**：O(n)
- **Trie树**：O(n*m)，n为条目数，m为平均字符串长度

## 设计亮点

### 1. 混合数据结构
- 结合了多种数据结构的优势
- 双向链表保持顺序，散列表快速查找，Trie树前缀查询
- 支持灵活的索引配置

### 2. 容错与持久化
- JSON格式易于调试
- 自动加载上次保存的状态
- 支持增量操作

### 3. 可扩展性
- 支持禁用/启用不同索引
- 易于添加新的查询类型
- 可扩展的命令系统

### 4. 用户友好
- 直观的命令行界面
- 详细的操作反馈
- 格式化的输出显示

## 约束与限制

### 当前限制
1. **电话号码唯一性**：每个电话号码只能对应一个联系人
2. **姓名重复**：支持多个联系人使用相同名字，但电话号码不同
3. **内存存储**：数据完全存储在内存中，未来可扩展为数据库

### 可能的改进方向
1. 支持数据库后端（SQLite/MySQL）
2. 支持更复杂的查询（模糊匹配、正则表达式）
3. 支持联系人分组和标签
4. 实现更完善的并发控制
5. 支持导入/导出多种格式（CSV、vCard等）

## 测试覆盖

### 单元测试（test_units.py）
- Contact类 - 对象创建
- ContactSystem - 增删改查操作
- Trie树 - 插入、删除、前缀查询
- 无索引系统 - 线性扫描功能
- 数据持久化 - 保存和加载

### 性能测试（test_performance.py）
- 1000/5000/10000 规模的数据
- 索引系统 vs 无索引系统对比
- 添加、查询操作的时间测量
- 加速比分析

## 项目规范

### 代码风格
- 遵循PEP 8规范
- 使用类型提示
- 完整的文档字符串
- 清晰的变量命名

### 注释和文档
- 核心算法有详细注释
- 类和方法有文档字符串
- 复杂逻辑有行内注释

### 错误处理
- 完整的参数验证
- 友好的错误提示
- 异常捕获和报告

## 作者信息

项目类型：数据结构与算法应用
技术栈：Python 3.7+
创建日期：2025年
版本：1.0

## 许可证

本项目用于教学和学习目的。

---

## 快速开始

```bash
# 1. 运行交互式系统
python cli.py

# 2. 在新终端运行单元测试
python test_units.py

# 3. 在新终端运行性能测试
python test_performance.py
```

## 故障排除

### 问题1：导入错误
**症状**：`ModuleNotFoundError`
**解决**：确保所有.py文件在同一目录

### 问题2：文件编码问题
**症状**：中文显示乱码
**解决**：确保终端使用UTF-8编码

### 问题3：数据丢失
**症状**：重启后数据消失
**解决**：在退出前执行 SAVE 命令保存数据

---

**最后更新**：2025年12月29日
